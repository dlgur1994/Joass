record_with_tcp_socket